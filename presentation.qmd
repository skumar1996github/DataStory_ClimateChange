---
title: "Data Story Title"
format: 
  revealjs:
    slide-number: true
---

## Slide deck for your presentation

Change this file to become your presentation slide deck.

The slide deck which tells the data story with visuals in a *narrative structure*[^1].

[^1]: See *Effective Data Storytelling*, Brent Dykes (2020), Figure 4.3.

## This deck is made with quarto revealjs

-   You find documentation of how to make revealjs presentations with quarto here: <https://quarto.org/docs/presentations/revealjs/>
-   Skip through the demo presentation and learn from there.

## Remove all this content ...

```{r}
library(ggplot2)
library(dplyr)
library(readr)
library(knitr)
library(scales)
library(readxl)
```

----------------------------------BETULS CODE STARTS HERE-----------------------

betuls content here...

----------------------------------BETULS CODE ENDS HERE--------------------------

## Insight 3: Climate responsibility is unequal - historical emissions are concentrated in rich countries

## Question 1: Which Countries Emit The Most Carbon Today?

```{r}
# read data
annual_emmisions_data <- read_csv("datasets/annual-co2-emissions-per-country.csv", show_col_types = FALSE)

# exclude known regions or groups
regions <- c(
  "Asia", "Africa", "North America", "South America", "Oceania",
  "European Union (27)", "European Union (28)", "Middle East (GCP)",
  "High-income countries", "Low-income countries", "Upper-middle-income countries",
  "Lower-middle-income countries", "Non-OECD (GCP)", "OECD (GCP)", "Asia (GCP)",
  "Europe (GCP)", "North America (GCP)", "Asia (excl. China and India)", "Europe (excl. EU-27)", "Europe (excl. EU-28)", "North America (excl. USA)", "South America (GCP)", "Africa (GCP)")

# create and plot top 10 list
top10_2023 <- annual_emmisions_data |>
  filter(Year == 2023) |>
  filter(!Entity %in% regions) |>
  select(Entity, `Annual CO₂ emissions`) |>
  arrange(desc(`Annual CO₂ emissions`)) |>
  slice_head(n = 11)

# plot 
ggplot(top10_2023,
       aes(x = reorder(Entity, `Annual CO₂ emissions`),
           y = `Annual CO₂ emissions`,
           fill = Entity)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(
    title = "Top 10 CO2 Emitting Countries (+ World) in 2023",
    x = "Country",
    y = "Annual CO2 Emissions (tonnes)",
  ) +
  scale_y_continuous(labels = label_number(scale_cut = cut_short_scale())) +
  theme_minimal()
```

## Question 2a: Which Countries Have Emitted The Most Carbon Dioxide In Total?

```{r}
countries <- c("United States", "China", "India", "Germany", "Europe", "Russia", "Japan")

# compute cumulative emissions by country over time
co2_countries <- annual_emmisions_data |>
  filter(Entity %in% countries) |>
  select(Entity, Year, `Annual CO₂ emissions`) |>
  group_by(Entity) |>
  arrange(Year, .by_group = TRUE) |>
  mutate(Cumulative = cumsum(`Annual CO₂ emissions`)) |>
  ungroup()

# pick milestone years for clearer bars
milestones <- c(1800, 1900, 1950, 2000, 2025)
co2_milestones <- co2_countries |>
  filter(Year %in% milestones)

# plot stacked bar chart
ggplot(co2_milestones,
       aes(x = factor(Year), y = Cumulative / 1e9, fill = Entity)) +
  geom_col() +
  labs(
    title = "Cumulative CO2 Emissions by Country (1750's–2023)",
    x = "Time Period",
    y = "Cumulative CO2 Emissions (billion tonnes)",
    fill = "Country"
  ) +
  scale_y_continuous(labels = label_number(accuracy = 1)) +
  theme_minimal(base_size = 12)
```

## Question 2b: Which Countries Have Emitted The Most Carbon Dioxide In Total?

```{r}
# pick the latest available year
latest_year <- max(co2_countries$Year, na.rm = TRUE)

# calculate share of global cumulative emissions
shares <- co2_countries |>
  filter(Year == latest_year) |>
  group_by(Year) |>
  mutate(share = 100 * Cumulative / sum(Cumulative)) |>
  ungroup() |>
  arrange(desc(share)) |>
  slice_head(n = 7)

# plot
ggplot(shares, 
       aes(x = reorder(Entity, share), 
           y = share, 
           fill = Entity)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(
    title = paste("Top 7 Cumulative Carbon Dioxide Emitters"),
    x = "Country",
    y = "Share of global cumulative Carbon Dioxide emissions (%)"
  ) +
  scale_y_continuous(labels = scales::label_number(accuracy = 0.1)) +
  theme_minimal(base_size = 13)
```

## Question 3: Which Countries Emit The Most Carbon Dioxide Per Person?

```{r}
# combine carbons emissions and population data
population_data <- read_excel("datasets/Country-Year-Population.xlsx")

emissions_2023 <- annual_emmisions_data |>
  filter(Year == 2023) |>
  filter(!Entity %in% regions) |>
  select(Code, Year, Annual_CO2_Emissions = `Annual CO₂ emissions`)

data_2023 <- population_data |>
  select(`Country Name`, `Country Code`, `2023 [YR2023]`) |>
  rename(
    Country_Name = `Country Name`,
    Country_Code = `Country Code`,
    Population_2023 = `2023 [YR2023]`
  )

combined_2023 <- emissions_2023 |>
  left_join(data_2023, by = c("Code" = "Country_Code"), relationship = "many-to-many") |>
  mutate(
    Population_2023 = as.numeric(Population_2023),
    CO2_per_capita = Annual_CO2_Emissions / Population_2023
  )
```

```{r}
countries_of_interest <- c("United States", "India", "China", "Germany","France", "Japan", "Indonesia")

selected_countries <- combined_2023 |>
  filter(Country_Name %in% countries_of_interest)

ggplot(selected_countries,
       aes(x = reorder(Country_Name, CO2_per_capita),
           y = CO2_per_capita,
           fill = Country_Name)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  labs(
    title = "CO2 Emissions per Capita (2023)",
    x = "Country",
    y = "CO2 Emissions per Capita (tonnes per person)"
  ) +
  scale_y_continuous(labels = label_number(accuracy = 0.1)) +
  theme_minimal()
```
